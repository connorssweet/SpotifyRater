{% extends "base.html" %}
{% block content %}
<div class="row">
    <div class="col-md-4">
        {% if album.cover_url %}
            <img src="{{ album.cover_url }}" class="img-fluid" alt="Cover">
        {% endif %}
        <h3 class="mt-2">{{ album.title }}</h3>
        <h5>{{ album.artist }}</h5>
        <h6>Tracklist:</h6>
        <ul>
        {% for track in (album.tracklist or '').split(',') %}
            {% if track %}
                <li>{{ track }}</li>
            {% endif %}
        {% endfor %}
        </ul>
        {% if current_user.is_authenticated and current_user.is_admin %}
            <form method="POST" action="{{ url_for('delete_album', album_id=album.id) }}" onsubmit="return confirm('Delete this album?');">
                <button type="submit" class="btn btn-danger btn-sm mt-2">Delete Album</button>
            </form>
        {% endif %}
    </div>

    <div class="col-md-8">
        <h4>Ratings & Comments</h4>
        {% for rating in album.ratings %}
            <div class="border p-2 mb-2">
                <strong>{{ rating.user.username }}</strong>: {{ rating.score }}/5
                <p>{{ rating.comment }}</p>
                {% if current_user.is_authenticated and (rating.user_id == current_user.id or current_user.is_admin) %}
                    <form method="POST" action="{{ url_for('delete_rating', rating_id=rating.id) }}">
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                {% endif %}
            </div>
        {% else %}
            <p>No ratings yet.</p>
        {% endfor %}

        {% if current_user.is_authenticated %}
        <h5 class="mt-3">Add / Update Your Rating</h5>
        <form method="POST">
            <div class="mb-2">
                <label>Score (1-5)</label>
                <input type="number" name="score" min="1" max="5" class="form-control" required>
            </div>
            <div class="mb-2">
                <label>Comment (optional)</label>
                <textarea name="comment" class="form-control"></textarea>
            </div>
            <button type="submit" class="btn btn-success">Submit Rating</button>
        </form>
        {% else %}
            <p><a href="{{ url_for('login') }}">Login</a> to add your rating.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
